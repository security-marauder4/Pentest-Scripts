#!/bin/bash

# Base directory for the structure
base_dir="/home/kali/Documents/job/Nmap/TCP/Full"

# Service to target
target_service="http"

# Wordlist path for feroxbuster
wordlist="/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt"

# Check if the wordlist exists
if [ ! -f "$wordlist" ]; then
    echo "Wordlist not found at $wordlist"
    exit 1
fi

# Iterate over each IP directory
for ip_dir in "$base_dir"/*
do
    # Check if it's a directory
    if [ -d "$ip_dir" ]; then
        # Extract the IP address from the directory name
        ip=$(basename "$ip_dir" | tr '_' '.')

        # Path to the target service directory
        service_dir="$ip_dir/Discovered_Ports/$target_service"

        # Check if the target service directory exists
        if [ -d "$service_dir" ]; then
            # Iterate over each port directory within the target service directory
            for port_dir in "$service_dir"/*
            do
                # Check if it's a directory
                if [ -d "$port_dir" ]; then
                    # Extract the port number from the directory name
                    port=$(basename "$port_dir")

                    # Construct the URL
                    url="http://$ip:$port"

                    # Run feroxbuster on the constructed URL
                    echo "Running feroxbuster on $url"
                    feroxbuster --url "$url" --wordlist "$wordlist" -o "$port_dir/feroxbuster_output.txt"

                    echo "Feroxbuster scan completed for $url. Output saved to $port_dir/feroxbuster_output.txt"
                fi
            done
        fi
    fi
done

echo "Feroxbuster scans completed for all HTTP services."