#!/bin/bash

# Prompt for the client name
read -p "Enter the client name: " client_name

# Base directory for the structure
base_dir="./$client_name/nmap"

# Check if the base directory exists
if [ ! -d "$base_dir" ]; then
    echo "Base directory not found!"
    exit 1
fi

# Collect all URLs to scan
urls=()

for protocol in tcp udp; do
    protocol_dir="$base_dir/$protocol"
    if [ ! -d "$protocol_dir" ]; then
        echo "Protocol directory $protocol_dir not found!"
        continue
    fi

    for ip_dir in "$protocol_dir"/*
    do
        if [ -d "$ip_dir" ]; then
            ip=$(basename "$ip_dir" | tr '_' '.')
            for port_dir in "$ip_dir/Discovered_Ports/http"/*
            do
                if [ -d "$port_dir" ]; then
                    port=$(basename "$port_dir")
                    url="http://$ip:$port"
                    gobuster_dir="$port_dir/gobuster"
                    mkdir -p "$gobuster_dir"
                    urls+=("$url $gobuster_dir")
                fi
            done
        fi
    done
done

# Run gobuster scans for all collected URLs
for entry in "${urls[@]}"; do
    url=$(echo "$entry" | awk '{print $1}')
    gobuster_dir=$(echo "$entry" | awk '{print $2}')
    echo "Running gobuster on $url"
    gobuster dir -u "$url" -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt > "$gobuster_dir/gobuster_output.txt"
    echo "Gobuster output saved to $gobuster_dir/gobuster_output.txt"
done

echo "Gobuster scans completed for all IP:PORT combinations in the http folder."
