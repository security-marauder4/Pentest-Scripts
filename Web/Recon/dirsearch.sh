#!/bin/bash

# Prompt for the client name
read -p "Enter the client name: " client_name

# Base directory for the structure
base_dir="./$client_name/nmap"

# Check if the base directory exists
if [ ! -d "$base_dir" ]; then
    echo "Base directory not found!"
    exit 1
fi

# Function to run dirsearch scans
run_dirsearch_scans() {
    for protocol in tcp udp; do
        protocol_dir="$base_dir/$protocol"
        if [ ! -d "$protocol_dir" ]; then
            echo "Protocol directory $protocol_dir not found!"
            continue
        fi

        for ip_dir in "$protocol_dir"/*
        do
            if [ -d "$ip_dir" ]; then
                ip=$(basename "$ip_dir" | tr '_' '.')
                for service_dir in "$ip_dir/Discovered_Ports"/*
                do
                    if [ -d "$service_dir" ]; then
                        protocol=$(basename "$service_dir")
                        for port_dir in "$service_dir"/*
                        do
                            if [ -d "$port_dir" ]; then
                                port=$(basename "$port_dir")
                                dirsearch_dir="$port_dir/dirsearch"
                                mkdir -p "$dirsearch_dir"
                                url="$protocol://$ip:$port"
                                echo "Running dirsearch on $url"
                                dirsearch -u "$url" -o "$dirsearch_dir/dirsearch_output.txt"
                                echo "Dirsearch output saved to $dirsearch_dir/dirsearch_output.txt"
                            fi
                        done
                    fi
                done
            fi
        done
    done
}

# Run all dirsearch scans
run_dirsearch_scans

echo "Web scans (Dirsearch) completed for all IP:PORT combinations."