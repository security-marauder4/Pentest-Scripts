#!/bin/bash

# Check if the user has provided an input file
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 ip_list.txt"
    exit 1
fi

# Assign the first argument to the variable 'file'
file=$1

# Check if the file exists
if [ ! -f "$file" ]; then
    echo "File not found!"
    exit 1
fi

# Base directory for the structure
base_dir="./sslscan"
mkdir -p "$base_dir"

# Ports to scan
ports=(80 8080 443)

# Read the file line by line
while IFS= read -r ip
do
    # Skip empty lines
    if [ -z "$ip" ]; then
        continue
    fi

    # Create a directory for the IP under the relevant base directory
    ip_dir="$base_dir/$ip"
    mkdir -p "$ip_dir"

    # Perform sslscan on specified ports for the given IP and save the output to a file in a dedicated port directory
    for port in "${ports[@]}"
    do
        echo "Scanning IP: $ip on port $port"
        port_dir="$ip_dir/$port"
        mkdir -p "$port_dir"
        sslscan --no-failed "$ip:$port" > "$port_dir/sslscan_output.txt"
    done
done < "$file"

echo "SSL scans completed. Results saved to individual output files in structured directories."