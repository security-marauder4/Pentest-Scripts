#!/bin/bash

# Base directory for the structure
base_dir="/home/kali/Documents/job/Nmap/TCP/Full"

# Service to target
target_service="netbios-ssn"

# Check if the base directory exists
if [ ! -d "$base_dir" ]; then
    echo "Base directory not found!"
    exit 1
fi

# Iterate over each IP directory
for ip_dir in "$base_dir"/*
do
    # Check if it's a directory
    if [ -d "$ip_dir" ]; then
        # Extract the IP address from the directory name
        ip=$(basename "$ip_dir" | tr '_' '.')

        # Path to the target service directory
        service_dir="$ip_dir/Discovered_Ports/$target_service"

        # Check if the target service directory exists
        if [ -d "$service_dir" ]; then
            # Create a subdirectory named 'enum4linux' within the service directory
            enum4linux_dir="$service_dir/enum4linux"
            mkdir -p "$enum4linux_dir"

            # Run enum4linux on the IP
            echo "Running enum4linux on $ip"
            enum4linux -A "$ip" > "$enum4linux_dir/enum4linux_output.txt"

            echo "enum4linux output saved to $enum4linux_dir/enum4linux_output.txt"
        fi
    fi
done

echo "enum4linux scan completed for $target_service on all IPs."